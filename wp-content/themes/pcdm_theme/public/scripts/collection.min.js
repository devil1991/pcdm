(function(){var t=function(t,e){return function(){return t.apply(e,arguments)}};window.Collection=function(){function e(e,i){var s;this.grid_ref=e,this.details_ref=i,this.onResize=t(this.onResize,this),this.onDetailsHidden=t(this.onDetailsHidden,this),this.showDetails=t(this.showDetails,this),this.onItemClick=t(this.onItemClick,this),this.switchToGrid=t(this.switchToGrid,this),this.updateDetails=t(this.updateDetails,this),this.switchToDetails=t(this.switchToDetails,this),this.onHistoryStateChange=t(this.onHistoryStateChange,this),this.is_dev=this.grid_ref.hasClass("js-dev"),this.category=this.grid_ref.attr("data-category"),s=this.grid_ref.attr("data-init-id"),this.w=$(window),this.wrapper=$("#wrapper"),this.header=this.grid_ref.find(".header-product-grid"),this.boxes=this.grid_ref.find(".item"),this.items_array=[],this.items_tot,this.current_id=null!=s&&""!==s?s:"",this.details,this.scroll_offset=1e3,window.is_switching=!1,event_emitter.addListener("SWITCH_TO_DETAILS",this.switchToDetails),event_emitter.addListener("UPDATE_DETAILS",this.updateDetails),event_emitter.addListener("SWITCH_TO_GRID",this.switchToGrid),event_emitter.addListener("DETAILS_HIDDEN",this.onDetailsHidden),this.setGrid(),this.setDetails(),this.has_history=!1,this.prev_state_id="home",this.is_dev||this.setHistory()}return e.prototype.setHistory=function(){return History.enabled?(this.has_history=!0,History.Adapter.bind(window,"statechange",this.onHistoryStateChange),History.replaceState({state:"home"},"","/"+this.category),""!==this.current_id?event_emitter.emitEvent("SWITCH_TO_DETAILS"):void 0):!1},e.prototype.onHistoryStateChange=function(){var t,e;return t=History.getState(),e=t.data.state,e!==this.prev_state_id?(this.prev_state_id=e,"home"===e?this.hideDetails():this.wrapper.hasClass("detail-on")?this.showDetails():this.dismantleGrid(),event_emitter.emitEvent("UPDATE_SHARING_DATA",[t.url])):void 0},e.prototype.switchToDetails=function(){return this.has_history?(History.pushState({state:this.current_id},"","/"+this.category+"/"+this.current_id),event_emitter.addListener("SWITCH_TO_GRID",this.switchToGrid)):this.dismantleGrid()},e.prototype.updateDetails=function(t){return this.current_id=t,this.has_history?(History.pushState({state:this.current_id},"","/"+this.category+"/"+this.current_id),event_emitter.addListener("SWITCH_TO_GRID",this.switchToGrid)):this.showDetails()},e.prototype.switchToGrid=function(){return this.has_history?(History.pushState({state:"home"},"","/"+this.category),event_emitter.addListener("SWITCH_TO_DETAILS",this.switchToDetails)):this.hideDetails()},e.prototype.setGrid=function(){var t,e,i,s,r,o,h,a,n,d,l;for(e=a=0,d=this.boxes.length;d>=0?d>a:a>d;e=d>=0?++a:--a)for(t=$(this.boxes[e]),h=t.offset().top,r=t.find("a"),o=n=0,l=r.length;l>=0?l>n:n>l;o=l>=0?++n:--n)s=$(r[o]),i=s.attr("data-id"),this.items_array.push({id:i,ref:s,offset:h}),s.bind("click",this.onItemClick);return this.items_tot=this.items_array.length},e.prototype.onItemClick=function(t){var e;return t.preventDefault(),is_switching?void 0:(window.is_switching=!0,e=$(t.currentTarget),this.current_id=e.attr("data-id"),event_emitter.emitEvent("SWITCH_TO_DETAILS"))},e.prototype.dismantleGrid=function(){var t,e,i,s,r,o,h;for(t=this.getCurrentIndex(),i=o=0,h=this.items_tot;h>=0?h>o:o>h;i=h>=0?++o:--o)s=this.items_array[i].ref,e=Math.min(Math.max(.25*(t-i),0),1.75),TweenLite.to(s,1,{css:{opacity:"0"},delay:e,ease:Power4.easeInOut});return TweenLite.to(this.header,2,{css:{opacity:"0"},ease:Power4.easeInOut}),r=Math.max(this.w.scrollTop()-this.scroll_offset,0),TweenLite.to(window,2,{scrollTo:{y:r},ease:Power4.easeInOut,onComplete:this.showDetails})},e.prototype.rebuildGrid=function(){var t,e,i,s,r,o,h;for(t=this.getCurrentIndex(),i=o=0,h=this.items_tot;h>=0?h>o:o>h;i=h>=0?++o:--o)s=this.items_array[i].ref,e=Math.min(Math.max(.25*(i+5-t),0),1.75),TweenLite.to(s,1,{css:{opacity:"1"},delay:e,ease:Power4.easeInOut});return TweenLite.to(this.header,2,{css:{opacity:"1"},ease:Power4.easeInOut}),r=this.getScrollById(),this.w.scrollTop(Math.max(r-this.scroll_offset,0)),TweenLite.to(window,2,{scrollTo:{y:r},ease:Power4.easeInOut,onComplete:function(){return window.is_switching=!1}})},e.prototype.getScrollById=function(){var t,e,i,s,r;for(i=0,t=s=0,r=this.items_tot;r>=0?r>s:s>r;t=r>=0?++s:--s)if(e=this.items_array[t],e.id===this.current_id){i=e.offset;break}return i},e.prototype.getCurrentIndex=function(){var t,e,i,s,r;for(e=0,t=s=0,r=this.items_tot;r>=0?r>s:s>r;t=r>=0?++s:--s)i=this.items_array[t],i.id===this.current_id&&(e=t);return e},e.prototype.setDetails=function(){var t,e,i,s,r;for(i=[],t=s=0,r=this.items_tot;r>=0?r>s:s>r;t=r>=0?++s:--s)e=this.items_array[t].id,i.push(e);return this.details=new CollectionDetails(this.details_ref,i,this.is_dev)},e.prototype.showDetails=function(){return this.wrapper.hasClass("detail-on")||(this.w.scrollTop(0),this.wrapper.addClass("detail-on"),this.grid_ref.hide()),this.details.updateContents(this.current_id)},e.prototype.hideDetails=function(){return this.details.removeContents()},e.prototype.onDetailsHidden=function(t){return this.current_id=t,this.wrapper.removeClass("detail-on"),this.grid_ref.show(),this.rebuildGrid()},e.prototype.onResize=function(t,e){return this.details?this.details.onResize(t,e):void 0},e}()}).call(this);
