(function(){var t=function(t,e){return function(){return t.apply(e,arguments)}};window.Newsletter=function(){function e(e){this.ref=e,this.getFieldById=t(this.getFieldById,this),this.showErrorsOnFields=t(this.showErrorsOnFields,this),this.onCommunicationClosed=t(this.onCommunicationClosed,this),this.onCommunicationOpened=t(this.onCommunicationOpened,this),this.testEmail=t(this.testEmail,this),this.testIsChecked=t(this.testIsChecked,this),this.testIsFilled=t(this.testIsFilled,this),this.onDataSaved=t(this.onDataSaved,this),this.saveData=t(this.saveData,this),this.onFormSubmit=t(this.onFormSubmit,this),this.onCheckboxFocus=t(this.onCheckboxFocus,this),this.onInputBlur=t(this.onInputBlur,this),this.onInputFocus=t(this.onInputFocus,this),this.form=this.ref.find("form"),this.fields=this.form.find(".campi"),this.submit_btn=this.form.find("input:submit"),this.thanks=this.ref.find(".feedback"),this.inputs_array=[],this.checkboxes_array=[],this.elements=[],event_emitter.addListener("COMMUNICATION_OPENED",this.onCommunicationOpened),event_emitter.addListener("COMMUNICATION_CLOSED",this.onCommunicationClosed),this.setElements(),this.setInteractions()}return e.prototype.setElements=function(){var t,e,i,s,r,n,a,o,h,u,d,l,c,f,p;for(r=this.fields.find("input:text"),o=this.fields.find("textarea"),i=h=0,l=o.length;l>=0?l>h:h>l;i=l>=0?++h:--h)r.push(o[i]);for(i=u=0,c=r.length;c>=0?c>u:u>c;i=c>=0?++u:--u)a=$(r[i]),e=a.parent(),s=a.attr("name"),n=a.hasClass("js-required"),a.attr("data-default",a.attr("value")),this.inputs_array.push({id:s,ref:a,field:e,is_required:n});for(t=this.fields.find("input:checkbox"),p=[],i=d=0,f=t.length;f>=0?f>d:d>f;i=f>=0?++d:--d)a=$(t[i]),e=a.parent().parent(),s=a.attr("name"),n=a.hasClass("js-required"),p.push(this.checkboxes_array.push({id:s,ref:a,field:e,is_required:n}));return p},e.prototype.setInteractions=function(){var t,e,i,s,r,n,a;for(e=s=0,n=this.inputs_array.length;n>=0?n>s:s>n;e=n>=0?++s:--s)i=this.inputs_array[e].ref,i.live("focus",this.onInputFocus).live("blur",this.onInputBlur);for(e=r=0,a=this.checkboxes_array.length;a>=0?a>r:r>a;e=a>=0?++r:--r)t=this.checkboxes_array[e].ref,t.change(this.onCheckboxFocus);return this.form.bind("submit",this.onFormSubmit)},e.prototype.onInputFocus=function(t){var e,i;return i=$(t.currentTarget),i.val()===i.attr("data-default")&&i.val(""),e=this.getFieldById(i.attr("name")),e.hasClass("error")?e.removeClass("error"):void 0},e.prototype.onInputBlur=function(t){var e;return e=$(t.currentTarget),""===e.val().replace(/\s+/g,"")?e.val(e.attr("data-default")):void 0},e.prototype.onCheckboxFocus=function(t){var e,i;return e=$(t.currentTarget),i=this.getFieldById(e.attr("name")),i.hasClass("error")?i.removeClass("error"):void 0},e.prototype.onFormSubmit=function(t){var e,i,s,r;return t.preventDefault(),e=!1,r=this.testIsFilled(),i=this.testIsChecked(),r&&i&&(s=this.testEmail("email"),s&&(e=!0)),e?this.collectData():void 0},e.prototype.collectData=function(){var t,e,i,s,r,n,a,o,h;for(e={},i=n=0,o=this.inputs_array.length;o>=0?o>n:n>o;i=o>=0?++n:--n)s=this.inputs_array[i],r=s.ref.val(),r===s.ref.attr("data-default")&&(r=""),e[s.id]=r;for(i=a=0,h=this.checkboxes_array.length;h>=0?h>a:a>h;i=h>=0?++a:--a)t=this.checkboxes_array[i],e[t.id]=t.ref.is(":checked");return e.lang=this.form.attr("data-lang"),this.saveData(e)},e.prototype.saveData=function(t){var e;return window.is_communicating?void 0:(event_emitter.emitEvent("COMMUNICATION_OPENED"),e=this.form.attr("data-send"),$.ajax({type:"POST",url:e,data:t,dataType:"json",success:this.onDataSaved,error:function(){return event_emitter.emitEvent("COMMUNICATION_CLOSED")}}))},e.prototype.onDataSaved=function(t){return event_emitter.emitEvent("COMMUNICATION_CLOSED"),1===t.success?this.onSuccess():this.onError(t.error,t.msg)},e.prototype.onSuccess=function(){return this.thanks.css({visibility:"visible",display:"block"}),this.form.css({visibility:"hidden"})},e.prototype.onError=function(t,e){return null!=t&&t.length>0&&this.showErrorsOnFields(t),null!=e&&""!==e?alert(e):void 0},e.prototype.testIsFilled=function(){var t,e,i,s,r,n;for(i=!0,t=r=0,n=this.inputs_array.length;n>=0?n>r:r>n;t=n>=0?++r:--r)e=this.inputs_array[t],e.is_required&&(s=e.ref.val().replace(/\s+/g,"").length,0===s&&(e.field.addClass("error"),i=!1),e.ref.val()===e.ref.attr("data-default")&&(e.field.addClass("error"),i=!1));return i},e.prototype.testIsChecked=function(){var t,e,i,s,r;for(i=!0,e=s=0,r=this.checkboxes_array.length;r>=0?r>s:s>r;e=r>=0?++s:--s)t=this.checkboxes_array[e],t.is_required&&(t.ref.is(":checked")||(t.field.addClass("error"),i=!1));return i},e.prototype.testEmail=function(t){var e,i,s;return i=!1,e=this.fields.find("input[name="+t+"]").val(),s=/^(([^<>()[\]\\.,;:\s@\"]+(\.[^<>()[\]\\.,;:\s@\"]+)*)|(\".+\"))@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\])|(([a-zA-Z\-0-9]+\.)+[a-zA-Z]{2,}))$/,s.test(e)?i=!0:this.getFieldById(t).addClass("error"),i},e.prototype.onCommunicationOpened=function(){return window.is_communicating=!0,this.submit_btn.addClass("disabled")},e.prototype.onCommunicationClosed=function(){return window.is_communicating=!1,this.submit_btn.removeClass("disabled")},e.prototype.showErrorsOnFields=function(t){var e,i,s,r,n;for(n=[],e=s=0,r=t.length;r>=0?r>s:s>r;e=r>=0?++s:--s)i=t[e],n.push(this.getFieldById(i).addClass("error"));return n},e.prototype.getFieldById=function(t){var e,i,s,r,n,a,o,h;for(s=n=0,o=this.inputs_array.length;o>=0?o>n:n>o;s=o>=0?++n:--n)r=this.inputs_array[s],r.id===t&&(i=r.field);for(s=a=0,h=this.checkboxes_array.length;h>=0?h>a:a>h;s=h>=0?++a:--a)e=this.checkboxes_array[s],e.id===t&&(i=e.field);return i},e}()}).call(this);